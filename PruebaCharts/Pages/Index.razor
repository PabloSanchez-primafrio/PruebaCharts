@page "/"
@inject IJSRuntime JS

<PageTitle>Index</PageTitle>

<h1>🚛 Gestión de Cargas del Remolque</h1>

<div class="alert alert-info">
    <strong>Instrucciones:</strong> Haz clic en cualquier carga para seleccionarla/deseleccionarla. 
    El total se recalcula automáticamente.
</div>

<div id="truckMap" style="height:500px;"></div>

@code {
    private IJSObjectReference? _module;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _module = await JS.InvokeAsync<IJSObjectReference>(
                "import", "/js/remolqueChart.js");

            await _module.InvokeVoidAsync("initRemolque", "truckMap");

            var cargas = await ObtenerCargasDesdeBDAsync();

            await _module.InvokeVoidAsync("updateRemolque", cargas, new
            {
                maxCols = (int?)null,
                showLabels = true,
                labelKey = "label",
                valueKey = "value",
                padding = 12
            });
        }
    }

    private Task<List<object>> ObtenerCargasDesdeBDAsync()
    {
        var lista = new List<object>
        {
            new { label = "C001", value = 35 },
            new { label = "C002", value = 55 },
            new { label = "C003", value = 80 },
            new { label = "C004", value = 20 },
            new { label = "C005", value = 65 },
            new { label = "C006", value = 10 }
        };
        return Task.FromResult(lista);
    }

    public async ValueTask DisposeAsync()
    {
        if (_module is not null)
            await _module.DisposeAsync();
    }
}